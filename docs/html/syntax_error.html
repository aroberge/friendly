
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Dealing with Syntax Errors &#8212; Friendly tracebacks 0.0.4 documentation</title>
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Friendly tracebacks - in English" href="tracebacks_en.html" />
    <link rel="prev" title="Adding an Exception" href="adding_exception.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="tracebacks_en.html" title="Friendly tracebacks - in English"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="adding_exception.html" title="Adding an Exception"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Friendly tracebacks 0.0.4 documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Dealing with Syntax Errors</a><ul>
<li><a class="reference internal" href="#adding-a-test-case">Adding a test case</a><ul>
<li><a class="reference internal" href="#raising-an-exception">Raising an exception</a></li>
<li><a class="reference internal" href="#catching-an-exception">Catching an exception</a></li>
</ul>
</li>
<li><a class="reference internal" href="#adding-generic-information">Adding generic information</a></li>
<li><a class="reference internal" href="#add-specific-information">Add specific information</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="adding_exception.html"
                        title="previous chapter">Adding an Exception</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="tracebacks_en.html"
                        title="next chapter">Friendly tracebacks - in English</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/syntax_error.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="dealing-with-syntax-errors">
<h1>Dealing with Syntax Errors<a class="headerlink" href="#dealing-with-syntax-errors" title="Permalink to this headline">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">SyntaxError</span></code>, and its subclasses, <code class="docutils literal notranslate"><span class="pre">IndentationError</span></code> and <code class="docutils literal notranslate"><span class="pre">TabError</span></code>,
are particular cases in that arise when a file cannot be parsed properly
by Python. Such files cannot be imported by pytest.
In order to create test cases, we need a two-step process.</p>
<p>In what follows, I assume that you are already familiar with how to
add test cases for other exceptions, and <strong>I will only focus on differences</strong>
from the other situation.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Checklist</strong></p>
<p>The following are the required steps before a pull request.
Each item is explained in a different section below. If you find
the instructions unclear, please do not hesitate to reach out.</p>
<blockquote class="last">
<div><ul class="simple">
<li>File an issue indicating that you are planning to work on a
given exception.</li>
<li><dl class="first docutils">
<dt>Add test case</dt>
<dd><ul class="first last">
<li>Add raise_some_exception.py file</li>
<li>Add catch_some_exception.py file</li>
</ul>
</dd>
</dl>
</li>
<li>Add generic information</li>
<li>Add specific information</li>
<li>Execute catch_some_exception.py and confirm visually it works as expected</li>
<li>Run pytest and confirm that your new test is included</li>
<li>Make a pull request</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="adding-a-test-case">
<h2>Adding a test case<a class="headerlink" href="#adding-a-test-case" title="Permalink to this headline">¶</a></h2>
<p>After you have filed an issue indicating that you wished to
adding coverage for an exception that is not previously
covered, you need to start by adding a test case.
As an example throughout, I will use the existing one for
<code class="docutils literal notranslate"><span class="pre">raise_indentation_error1.py</span></code>.</p>
<p>Note that tests for these exceptions are found in the tests/syntax/ directory.</p>
<div class="section" id="raising-an-exception">
<h3>Raising an exception<a class="headerlink" href="#raising-an-exception" title="Permalink to this headline">¶</a></h3>
<p>Your test file name should start with <code class="docutils literal notranslate"><span class="pre">raise_</span></code>,
such as <code class="docutils literal notranslate"><span class="pre">raise_indentation_error1.py</span></code>.
Here is the content of that file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;Should raise IndentationError&#39;&#39;&#39;</span>

<span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
<span class="k">pass</span>
</pre></div>
</div>
<p>As you can see, it contains invalid code.</p>
<p>For this project, pytest has been configured such that it only
includes files whose names begin with <code class="docutils literal notranslate"><span class="pre">test_</span></code> or <code class="docutils literal notranslate"><span class="pre">catch_</span></code>.
Therefore, it will ignore this file.</p>
</div>
<div class="section" id="catching-an-exception">
<h3>Catching an exception<a class="headerlink" href="#catching-an-exception" title="Permalink to this headline">¶</a></h3>
<p>Now that we have script that can raise an exception,
we need to create a script that will catch it, and can
also be used by pytest which we use as our test runner.
Here’s only part of the content of <code class="docutils literal notranslate"><span class="pre">catch_name_error.py</span></code>,
with some numbered comments added, to which we refer below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">friendly_traceback</span>
<span class="kn">import</span> <span class="nn">sys</span>


<span class="k">def</span> <span class="nf">test_indentation_error1</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">raise_indentation_error1</span>  <span class="c1"># 1 for pytest</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">raise_indentation_error1</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">friendly_traceback</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="o">*</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">(),</span> <span class="n">redirect</span><span class="o">=</span><span class="s2">&quot;capture&quot;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">friendly_traceback</span><span class="o">.</span><span class="n">get_output</span><span class="p">()</span>
    <span class="k">assert</span> <span class="s2">&quot;IndentationError: expected an indented block&quot;</span> <span class="ow">in</span> <span class="n">result</span>  <span class="c1"># 2</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">test_indentation_error1</span><span class="p">())</span>
</pre></div>
</div>
<ol class="arabic simple">
<li>Importing a test using pytest is done differently than importing it when
running this file as standalone</li>
<li>There are three possible cases of <code class="docutils literal notranslate"><span class="pre">IndentationError</span></code>. We try to be
as specific as possible in terms of which case will be indicated by Python.</li>
</ol>
<p>At this point, running pytest from the root directory should
work, and you should see your test case included.  You can also
run this test directly, using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">tests</span><span class="o">/</span><span class="n">syntax</span><span class="o">/</span><span class="n">catch_indentation_error</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="adding-generic-information">
<h2>Adding generic information<a class="headerlink" href="#adding-generic-information" title="Permalink to this headline">¶</a></h2>
<p>This has already been done for <code class="docutils literal notranslate"><span class="pre">SyntaxError</span></code> and its subclasses.
Feel free to suggest improvements to the explanation given.</p>
</div>
<div class="section" id="add-specific-information">
<h2>Add specific information<a class="headerlink" href="#add-specific-information" title="Permalink to this headline">¶</a></h2>
<p>This is the tricky part.</p>
<p>The three possible causes of <code class="docutils literal notranslate"><span class="pre">IndentationError</span></code> are already covered;
this is also the case for <code class="docutils literal notranslate"><span class="pre">TabError</span></code>.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">SyntaxError</span></code>, we actually need to get access to the offending
code, analyze it and see if we can make an educated guess as to the
cause of the error and give proper feedback.</p>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">Add code example for providing specific information for SyntaxError</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="tracebacks_en.html" title="Friendly tracebacks - in English"
             >next</a> |</li>
        <li class="right" >
          <a href="adding_exception.html" title="Adding an Exception"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Friendly tracebacks 0.0.4 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, André Roberge.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.4.
    </div>
  </body>
</html>